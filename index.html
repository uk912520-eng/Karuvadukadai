<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ğŸŸ à®•à®°à¯à®µà®¾à®Ÿà¯ à®•à®Ÿà¯ˆ - Customer</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',Arial,sans-serif;background:#e9f1f7;padding:20px}
        .header{text-align:center;background:linear-gradient(135deg,#ff6b35,#f7931e);color:#fff;padding:20px;border-radius:15px;margin-bottom:25px;font-weight:700;font-size:1.8rem;}
        .container{max-width:900px;margin:0 auto;background:#fff;padding:25px;border-radius:25px;box-shadow:0 12px 35px rgba(0,0,0,0.1)}
        .search-box{padding:15px;border:2px solid #ddd;border-radius:30px;width:100%;font-size:1.1rem;margin-bottom:30px;box-sizing:border-box}
        .products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:30px}
        .product-card{background:#f8f9fa;padding:30px;border-radius:20px;text-align:center;box-shadow:0 10px 25px rgba(0,0,0,0.1);transition:transform 0.3s ease}
        .product-card:hover{transform:translateY(-6px)}
        .product-photo{width:120px;height:120px;border-radius:20px;margin:0 auto 20px;overflow:hidden;background:#fff;border:4px solid #ff6b35}
        .product-photo img{width:100%;height:100%;object-fit:cover}
        .product-name{font-size:1.6rem;font-weight:800;color:#333;margin-bottom:12px}
        .product-price{font-size:2rem;color:#ff6b35;font-weight:bold;margin-bottom:15px}
        .product-desc{color:#666;font-size:1.1rem;margin-bottom:25px;min-height:50px}
        .order-btn{padding:15px 40px;background:#25d366;color:#fff;border:none;border-radius:50px;font-size:1.2rem;letter-spacing:1.5px;cursor:pointer;transition:background 0.3s ease}
        .order-btn:hover{background:#128c7e}
        .toggle-orders-btn{margin-top:30px;background:#ff6b35;color:#fff;border:none;padding:15px 50px;font-size:1.2rem;cursor:pointer;border-radius:30px;display:block;margin-left:auto;margin-right:auto;box-shadow:0 6px 15px rgba(255,107,53,0.4)}
        .order-history{margin-top:25px;display:none;background:#f9f9f9;padding:20px;border-radius:15px;box-shadow:0 6px 20px rgba(0,0,0,0.05)}
        .order-history table{width:100%;border-collapse:collapse}
        .order-history th, .order-history td{padding:12px;border-bottom:1px solid #ddd;text-align:left}
        .order-history th{background:#ff6b35;color:#fff}
        .password-section{margin-bottom:15px;text-align:center}
        .password-input{padding:12px;border-radius:12px;border:2px solid #ddd;width:250px;font-size:1.1rem}
        .password-btn{padding:12px 30px;background:#25d366;color:#fff;border:none;border-radius:12px;cursor:pointer;font-size:1.1rem;margin-left:10px}
        .password-btn:hover{background:#128c7e}
        .notice{margin-top:15px;color:#ff6b35;font-weight:bold;text-align:center}
    </style>
</head>
<body>
    <div class="header">ğŸŸ à®•à®°à¯à®µà®¾à®Ÿà¯ à®•à®Ÿà¯ˆ</div>

    <div class="container">
        <input type="text" id="searchBox" class="search-box" placeholder="à®¨à¯†à®¤à¯à®¤à®¿à®²à®¿, à®šà¯‚à®°à¯ˆ, à®µà®à¯à®šà®°à®®à¯ à®¤à¯‡à®Ÿà¯à®™à¯à®•à®³à¯..." />

        <div id="productsGrid" class="products-grid"></div>

        <button class="toggle-orders-btn" id="toggleOrderHistoryBtn">ğŸ—‚ï¸ à®à®©à¯ à®†à®°à¯à®Ÿà®°à¯à®•à®³à¯ à®ªà®¾à®°à¯à®•à¯à®•</button>

        <div class="order-history" id="orderHistorySection">
            <div class="password-section">
                <input type="password" id="orderPassword" class="password-input" placeholder="à®•à®Ÿà®µà¯à®šà¯à®šà¯Šà®²à¯à®²à¯ˆ à®‰à®³à¯à®³à®¿à®Ÿà®µà¯à®®à¯"/>
                <button id="orderPasswordBtn" class="password-btn">à®‰à®³à¯à®³à®¿à®Ÿà¯</button>
            </div>
            <div id="customerOrdersContent"></div>
        </div>
    </div>

    <script>
        const ADMIN_WHATSAPP = '919791899825';

        let products = JSON.parse(localStorage.getItem('karuvadu_products') || '[]');
        let allCustomerOrders = JSON.parse(localStorage.getItem('karuvadu_customer_orders') || '[]');

        // RENDER PRODUCTS
        function renderProducts(filtered=products) {
            const container = document.getElementById('productsGrid');
            if(filtered.length === 0){
                container.innerHTML = '<p style="color:#777;text-align:center;padding:40px;">Products à®‡à®²à¯à®²à¯ˆ. Admin panel à®² products à®šà¯‡à®°à¯à®•à¯à®•à®µà¯à®®à¯.</p>';
                return;
            }
            container.innerHTML = filtered.map(p => `
                <div class="product-card">
                    <div class="product-photo">${p.photo ? `<img src="${p.photo}" alt="${p.name}">` : 'ğŸŸ'}</div>
                    <div class="product-name">${p.name}</div>
                    <div class="product-price">${p.price}</div>
                    <div class="product-desc">${p.desc}</div>
                    <button class="order-btn" onclick="placeOrder('${p.name}','${p.price}')">ğŸ›’ WhatsApp Order</button>
                </div>
            `).join('');
        }

        // Place order with prompts + save to customer orders, notify admin
        function placeOrder(name, price) {
            let customerName = prompt('à®‰à®™à¯à®•à®³à¯ à®ªà¯†à®¯à®°à¯:');
            if(!customerName) { alert('à®ªà¯†à®¯à®°à¯ à®¤à¯‡à®µà¯ˆ'); return; }
            let phone = prompt('à®‰à®™à¯à®•à®³à¯ à®ªà¯‹à®©à¯ à®à®£à¯:');
            if(!phone) { alert('à®ªà¯‹à®©à¯ à®¤à¯‡à®µà¯ˆ'); return; }
            let address = prompt('à®Ÿà¯†à®²à®¿à®µà®°à®¿ à®®à¯à®•à®µà®°à®¿ à®®à¯à®´à¯à®®à¯ˆà®¯à®¾à®• (à®ªà®¤à®¿à®µà¯ à®šà¯†à®¯à¯à®¯à®ªà¯à®ªà®Ÿà¯à®•à®¿à®±à®¤à®¾?):');
            if(!address) { alert('à®®à¯à®•à®µà®°à®¿ à®¤à¯‡à®µà¯ˆ'); return; }

            // Whatsapp message
            let message = `ğŸ›’ à®•à®°à¯à®µà®¾à®Ÿà¯ à®•à®Ÿà¯ˆ à®†à®°à¯à®Ÿà®°à¯ ğŸŸ\n\n` +
                `ğŸ‘¤ à®ªà¯†à®¯à®°à¯: ${customerName}\n` +
                `ğŸ“± à®ªà¯‹à®©à¯: ${phone}\n` +
                `ğŸ“ à®®à¯à®•à®µà®°à®¿: ${address}\n\n` +
                `ğŸŸ à®ªà¯Šà®°à¯à®³à¯: ${name}\n` +
                `ğŸ’° à®µà®¿à®²à¯ˆ: ${price}\n\n` +
                `à®¨à®©à¯à®±à®¿! ğŸ™`;

            window.open(`https://wa.me/${ADMIN_WHATSAPP}?text=${encodeURIComponent(message)}`, '_blank');

            // Save customer order locally for history
            let orderDetails = {
                id: Date.now(),
                customer: customerName,
                phone: phone,
                address: address,
                items: name,
                total: price,
                date: new Date().toLocaleString('ta-IN')
            };
            allCustomerOrders.unshift(orderDetails);
            localStorage.setItem('karuvadu_customer_orders', JSON.stringify(allCustomerOrders));

            // Notify admin by incrementing new order count in localStorage
            let notifKey = 'karuvadu_new_order_notification_count';
            let count = parseInt(localStorage.getItem(notifKey) || '0', 10);
            localStorage.setItem(notifKey, count + 1);

            alert('à®‰à®™à¯à®•à®³à¯ à®†à®°à¯à®Ÿà®°à¯ à®ªà®¤à®¿à®µà®¾à®•à®¿à®¯à®¤à¯! Adminà®•à¯à®•à¯ à®…à®±à®¿à®µà®¿à®ªà¯à®ªà¯ à®…à®©à¯à®ªà¯à®ªà®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯.');
        }

        // SEARCH FUNCTIONALITY
        document.getElementById('searchBox').addEventListener('input', function(){
            const query = this.value.toLowerCase();
            const filtered = products.filter(p => p.name.toLowerCase().includes(query) || p.desc.toLowerCase().includes(query));
            renderProducts(filtered);
        });

        // ORDER HISTORY PROTECTION
        const toggleOrdersBtn = document.getElementById('toggleOrderHistoryBtn');
        const orderHistorySection = document.getElementById('orderHistorySection');
        const orderPasswordInput = document.getElementById('orderPassword');
        const orderPasswordBtn = document.getElementById('orderPasswordBtn');
        const customerOrdersContent = document.getElementById('customerOrdersContent');

        toggleOrdersBtn.onclick = () => {
            if(orderHistorySection.style.display === 'block'){
                orderHistorySection.style.display = 'none';
                orderPasswordInput.value = '';
                customerOrdersContent.innerHTML = '';
            } else {
                orderHistorySection.style.display = 'block';
            }
        };

        orderPasswordBtn.onclick = () => {
            const password = orderPasswordInput.value;
            if(password !== 'customer123'){
                alert('à®¤à®µà®±à®¾à®© à®•à®Ÿà®µà¯à®šà¯à®šà¯Šà®²à¯!');
                return;
            }
            orderPasswordInput.value = '';
            showCustomerOrders();
        };

        // SHOW Customer Orders Table
        function showCustomerOrders(){
            if(allCustomerOrders.length === 0){
                customerOrdersContent.innerHTML = '<p style="text-align:center;color:#999;">à®à®¤à®¿à®°à¯à®•à®¾à®²à®¤à¯à®¤à®¿à®²à¯ à®‰à®™à¯à®•à®³à¯ à®†à®°à¯à®Ÿà®°à¯à®•à®³à¯ à®‡à®™à¯à®•à¯‡ à®•à®¾à®Ÿà¯à®Ÿà®ªà¯à®ªà®Ÿà¯à®®à¯.</p>';
                return;
            }
            let html = `<table>
                <thead>
                    <tr>
                        <th>à®¤à¯‡à®¤à®¿</th><th>à®ªà¯Šà®°à¯à®Ÿà¯à®•à®³à¯</th><th>à®®à¯Šà®¤à¯à®¤à®®à¯</th><th>à®®à¯à®•à®µà®°à®¿</th>
                    </tr>
                </thead>
                <tbody>
                    ${allCustomerOrders.map(o=>`
                        <tr>
                            <td>${o.date}</td>
                            <td>${o.items}</td>
                            <td>${o.total}</td>
                            <td>${o.address}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>`;
            customerOrdersContent.innerHTML = html;
        }

        // INITIAL RENDER
        renderProducts();
    </script>
</body>
</html>
